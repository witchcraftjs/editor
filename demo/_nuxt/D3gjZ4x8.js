import{a6 as D,a1 as Y,v as p,a7 as Z,B as G,m as J,c as L,H as q,C as K,E as V,w as T,D as U,L as _,q as k,Q as ee,F as te,o as C,a2 as oe,Z as re}from"./ChiTXbtN.js";import{g as ie}from"./CRo8hmbH.js";import{a as ae}from"./9cslYIr4.js";import{i as $}from"./B9Vz3BzZ.js";const he=Object.assign({name:"LibPopup",inheritAttrs:!1},{__name:"WPopup",props:D({id:{type:String,required:!1},useDialogForBackdrop:{type:Boolean,required:!1,default:!1},useBackdrop:{type:Boolean,required:!1,default:!0},preferredHorizontal:{type:[Array,Function],required:!1,default:()=>["center-most","either"]},preferredVertical:{type:[Array,Function],required:!1,default:()=>["top","bottom","either"]},avoidRepositioning:{type:Boolean,required:!1,default:!1},modifyPosition:{type:Function,required:!1},canClose:{type:Boolean,required:!1,default:!0}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:D(["close"],["update:modelValue"]),setup(l,{expose:M,emit:P}){const W=ie(),a=l,F=Y(),A=P,g=p(null),y=p(null),h=p(null),B=p(null),n=p({}),d=Z(l,"modelValue",{type:Boolean,default:!1});let u=d.value;const S=()=>({x:0,y:0,width:window.innerWidth,height:window.innerHeight,top:0,bottom:0,left:0,right:0});let f;const x=(s=!1)=>{requestAnimationFrame(()=>{const H=$(a.preferredHorizontal)&&a.preferredHorizontal[0]==="center-screen",m=$(a.preferredVertical)&&a.preferredVertical[0]==="center-screen",Q=(H||typeof a.preferredHorizontal=="function")&&(m||typeof a.preferredVertical=="function");if(!y.value||!g.value||!h.value&&!Q){n.value={};return}const e=h.value?.getBoundingClientRect(),i=B.value?.getBoundingClientRect()??(a.useBackdrop?S():document.body.getBoundingClientRect()),r=y.value.getBoundingClientRect();let o={};if(!s&&d.value&&a.avoidRepositioning&&h.value&&f){const c=h.value.getBoundingClientRect().x-f.x,X=h.value.getBoundingClientRect().y-f.y;n.value.x+=c,n.value.y+=X,f=e;return}const t={left:0,right:0,leftLeft:0,rightRight:0,leftFromCenter:0,rightFromCenter:0,topFromCenter:0,bottomFromCenter:0,top:0,bottom:0};e&&(t.left=e.x+e.width-i.x,t.leftLeft=e.x-i.x,t.right=i.x+i.width-(e.x+e.width),t.rightRight=i.x+i.width-e.x,t.leftFromCenter=e.x+e.width/2-i.x,t.rightFromCenter=i.x+i.width-(e.x+e.width/2),t.topFromCenter=e.y+e.height/2-i.y,t.bottomFromCenter=i.y+i.height-(e.y+e.height/2),t.top=e.y-i.y,t.bottom=i.y+i.height-(e.y+e.height));const{preferredHorizontal:w,preferredVertical:v}=a;let R,z;if(typeof w=="function")o.x=w(e,r,i,t);else e:for(const c of w)switch(c){case"center-screen":r.width<i.width?o.x=i.width/2-r.width/2:(o.x=0,R=o.x);break;case"center-most":case"center":if(t.leftFromCenter>=r.width/2&&t.rightFromCenter>=r.width/2){o.x=e.x+e.width/2-r.width/2;break e}if(t.rightFromCenter+t.leftFromCenter<=r.width){o.x=0;break e}if(c==="center-most")if(t.leftFromCenter<t.rightFromCenter){o.x=e.x+e.width/2-t.leftFromCenter;break e}else{o.x=e.x+e.width/2+t.rightFromCenter-r.width;break e}break;case"left-most":if(t.left>=r.width){o.x=e.x-r.width;break e}else{o.x=0;break e}case"right-most":if(t.right>=r.width){o.x=e.x+e.width;break e}else{o.x=i.x+i.width-r.width;break e}case"right":if(t.right>=r.width){o.x=e.x;break e}break;case"left":if(t.left>=r.width){o.x=e.x+e.width-r.width;break e}break;case"either":if(t.right>=t.left){o.x=e.x;break e}else{o.x=e.x+e.width-r.width;break e}}if(typeof v=="function")o.y=v(e,r,i,t);else e:for(const c of v)switch(c){case"center-screen":r.height<i.height?o.y=i.height/2-r.height/2:(o.y=0,z=o.y);break;case"top":if(t.top>=r.height){o.y=e.y-r.height;break e}break;case"bottom":if(t.bottom>=r.height){o.y=e.y+e.height;break e}break;case"top-most":if(t.top>=r.height){o.y=e.y-r.height;break e}else{o.y=0;break e}case"bottom-most":if(t.bottom>=r.height){o.y=e.y+e.height;break e}else{o.y=i.y+i.height-r.height;break e}case"center-most":case"center":if(t.topFromCenter>=r.height/2&&t.bottomFromCenter>=r.height/2){o.y=e.y+e.height/2-r.height/2;break e}if(t.bottomFromCenter+t.topFromCenter<=r.height){o.y=0;break e}if(c==="center-most")if(t.topFromCenter<t.bottomFromCenter){o.y=e.y+e.height/2-t.topFromCenter;break e}else{o.y=e.y+e.height/2+t.bottomFromCenter-r.height;break e}break;case"either":if(t.top>=t.bottom){o.y=e.y-r.height;break e}else{o.y=e.y+e.height;break e}}o.maxWidth=R??void 0,o.maxHeight=z??void 0,a.modifyPosition&&(o=a.modifyPosition(o,e,r,i,t)),n.value=o,f=e})},I=()=>{u||(u=!0,d.value=u,a.useBackdrop&&a.useDialogForBackdrop&&g.value?.showModal(),x(!0))},E=()=>{if(u){const s=a.canClose??!1;if(A("close"),s===!1)return;u=!1,d.value=u,n.value.maxWidth=void 0,a.useBackdrop&&a.useDialogForBackdrop&&g.value?.close()}},b=()=>x(),O=()=>{window.addEventListener("resize",b),window.addEventListener("scroll",b,!0)},j=()=>{window.removeEventListener("resize",b),window.removeEventListener("scroll",b,!0)};G([d,y],()=>{d.value?(I(),O()):(E(),j())});const N=s=>{s.preventDefault(),E()};return J(()=>{x()}),M({recompute:x,setReference:s=>{h.value=s},setBackground:s=>{B.value=s}}),(s,H)=>(C(),L(te,null,[q(s.$slots,"button",{extractEl:m=>h.value=m}),d.value||l.useDialogForBackdrop?(C(),K(ee(l.useDialogForBackdrop?"dialog":"div"),U({key:0,id:l.id??k(W),class:k(ae)(l.useBackdrop&&l.useDialogForBackdrop&&`
			popup--backdrop
			bg-transparent
			p-0
			backdrop:bg-transparent
		`,d.value&&l.useBackdrop&&!l.useDialogForBackdrop&&`
			popup--backdrop
			z-100
			fixed
			inset-0
		`,k(F).class)},{...k(F),class:void 0},{ref_key:"dialogEl",ref:g,onMousedown:_(N,["self"])}),{default:T(()=>[d.value?(C(),L("div",{key:0,class:re(`popup z-100 fixed ${a.avoidRepositioning?"transition-[top,left]":""}`),style:oe(`
		top:${n.value.y}px;
		left:${n.value.x}px;
		${n.value.maxWidth?`max-width:${n.value.maxWidth}px`:""}
		${n.value.maxHeight?`max-height:${n.value.maxHeight}px`:""}
		`)},[q(s.$slots,"popup",{position:n.value,extractEl:m=>y.value=m})],6)):V("",!0)]),_:3},16,["id","class"])):V("",!0)],64))}});export{he as default};
