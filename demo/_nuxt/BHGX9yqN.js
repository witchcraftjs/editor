import{p,v as N,B as q,aa as $,a6 as j,a7 as x,V as ee,c as D,E,F as te,G as se,D as T,q as h,o as M,L as H,H as ne,a as C,C as ae,t as ie}from"./ChiTXbtN.js";import{u as le}from"./CxzPWhlJ.js";import{i as re}from"./BhoX2VZY.js";import{p as U}from"./B834ZAMc.js";import{r as oe}from"./DOfhXivz.js";import{h as ue}from"./CQ5ND8ze.js";import{a as K}from"./9cslYIr4.js";import ge from"./D2-izZPo.js";import{g as fe}from"./CRo8hmbH.js";function G(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function ce(t,a,S,g,n,o=!1){if(typeof n.suggestions?.[0]=="object"&&!n.suggestionLabel&&!n.suggestionsFilter)throw new Error("`suggestionLabel` or `suggestionsFilter` must be passed if suggestions are objects.");const l=N(-1);if(q(l,e=>{g("update:activeSuggestion",e)}),n.suggestions)for(const e of n.suggestions)_(e,n.suggestionLabel);const r=e=>(_(e,n.suggestionLabel),G(e)?n.suggestionLabel(e):e),L=(e,d)=>e===""?[...d]:d.filter(y=>Array.isArray(a.value)&&a.value.includes(r(y))?!0:r(y).toLowerCase().includes(e.toLowerCase())),b=p(()=>n.suggestionsFilter??L),c=p(()=>{if(n.suggestions){const e=[...n.suggestions];return Array.isArray(a.value)&&!n.showSelectedValues&&U(e,a.value),b.value(t.value,e)}}),i=p(()=>(c.value?.length??0)>0),I=p(()=>(c.value?.length??0)>1),A=p(()=>n.suggestions?.find(e=>t.value===r(e))),B=p(()=>!n.restrictToSuggestions&&n.isValid||i.value),s=p(()=>n.canOpen&&(re(t.value)&&n.allowOpenEmpty||i.value)),u=p(()=>{if(n.suggestions){const e=i.value?c.value:n.suggestions;return n.restrictToSuggestions&&!B.value,e}});function v(e){if(Array.isArray(a.value)){if(a.value.includes(e))return oe(a.value,e),!0;U(a.value,[e])}else a.value=e;return!1}function f(){n.canClose&&(o&&console.log("closeSuggestions"),S.value=!1,l.value=-1)}function w(){o&&console.log("openSuggestions",{openable:s.value}),s.value&&(l.value===-1&&(A.value?l.value=c.value?.indexOf(A.value)??-1:l.value=0),S.value=!0)}function P(e,d=!0){if(e<-1||e>(u.value?.length??0)||(o&&console.log("enterSuggestion",e),u.value===void 0))return;const y=u.value[e],F=r(y),m=v(F);t.value=Array.isArray(a.value)?"":r(y),d&&f(),g("submit",F,$(y),m)}function R(e=!0){if(l.value===-1){n.restrictToSuggestions?o&&console.log("enterSelected, no active suggestion, ignoring"):(o&&console.log("enterSelected, unrestricted, emitting submit"),g("submit",t.value));return}o&&console.log("enterSelected"),P(l.value,e)}function k(e){o&&console.log("selectSuggestion",e),e>=-1&&(l.value=e),e===1/0&&(u.value?.length??0)>0&&(l.value=u.value.length-1)}function z(){S.value?f():w()}function W(){u.value&&(l.value>0?l.value--:u.value&&(l.value=u.value.length-1))}function J(){u.value&&(l.value>=u.value.length-1?l.value=0:l.value++)}function Q(){k(0)}function X(){k(1/0)}function Y(){if(Array.isArray(a.value)){t.value="";return}o&&console.log("cancel"),t.value=r(a.value),f()}q(()=>n.canOpen,e=>{e||(o&&console.log("canOpen changed to false, closing suggestions"),f())}),q(s,e=>{e||(o&&console.log("openable changed to false, closing suggestions"),f())}),q(B,()=>{B.value||(o&&console.log("isValidSuggestion changed to false, opening suggestions"),w())}),q(a,()=>{Array.isArray(a.value)?t.value="":t.value=r(a.value),o&&console.log("modelValue changed")});function Z(e,d){if(d.length===0)return 0;let y,F=-1;for(let m=0;m<e.length;m++){const V=e[m],O=r(V);O.slice(0,d.length)===d&&O.length>(y?.[0]?.length??0)&&(y=O,F=m)}return F}return q(t,()=>{if(o&&console.log("input changed:",t.value,"modelValue:",a.value),!(!Array.isArray(a.value)&&r(a.value)===t.value))if(i.value&&(o&&console.log("input changed, suggestion available, opening suggestions"),w()),!n.restrictToSuggestions&&!Array.isArray(a.value)&&(o&&console.log("input changed, unrestricted, setting modelValue"),v(t.value)),A.value&&c.value)o&&console.log("input changed, exactly matching, setting activeSuggestion"),k(c.value.indexOf(A.value));else{o&&console.log("input changed, not exactly matching, finding longest match");const e=n.suggestionSelector?.(u.value??[],t.value)??Z(u.value??[],t.value);k(e)}}),{list:c,filtered:u,active:l,available:i,moreThanOneAvailable:I,hasExactlyMatching:A,hasValidSuggestion:B,openable:s,getLabel:r,$open:S,open:w,close:f,enterSelected:R,enterIndex:P,toggle:z,cancel:Y,select:k,prev:W,next:J,first:Q,last:X}}function Le(t,a,S,g){return p(()=>({"aria-autocomplete":g!==void 0?"both":void 0,"aria-controls":g!==void 0?`suggestions-${t.value}`:void 0,role:g?"combobox":void 0,"aria-expanded":g!==void 0?a.value:void 0,"aria-activedescendant":a.value?`suggestion-${t.value}-${S.value}`:void 0}))}function _(t,a){if(G(t)&&!a)throw new Error("`suggestionLabel` must be passed if suggestions are objects.")}const ve=["id","data-open"],de=["id","aria-selected","aria-label","onMouseover","onMouseup"],ye={class:"flex gap-2 nowrap"},pe=Object.assign({name:"LibSuggestions",inheritAttrs:!1},{__name:"WSuggestions",props:j({id:{type:String,required:!1},label:{type:String,required:!1},disabled:{type:Boolean,required:!1,default:!1},readonly:{type:Boolean,required:!1,default:!1},border:{type:Boolean,required:!1,default:!0},unstyle:{type:Boolean,required:!1,default:!1},filterKeydown:{type:Function,required:!1,default:void 0},filterBlur:{type:Function,required:!1},filterFocus:{type:Function,required:!1},suggestions:{type:Array,required:!1},suggestionLabel:{type:Function,required:!1},restrictToSuggestions:{type:Boolean,required:!1},updateOnlyOnSubmit:{type:Boolean,required:!1},suggestionsFilter:{type:Function,required:!1},allowOpenEmpty:{type:Boolean,required:!1},canOpen:{type:Boolean,required:!1,default:!0},canClose:{type:Boolean,required:!1,default:!0},isValid:{type:Boolean,required:!1,default:!0},suggestionSelector:{type:Function,required:!1},showSelectedValues:{type:Boolean,required:!1}},{modelValue:{type:null,required:!0},modelModifiers:{},inputValue:{type:String,default:""},inputValueModifiers:{},open:{type:Boolean,default:!1},openModifiers:{}}),emits:j(["submit","update:isOpen","update:activeSuggestion"],["update:modelValue","update:inputValue","update:open"]),setup(t,{expose:a,emit:S}){const g=le(["item"]),n=S,o=fe(),l=t,r=x(t,"modelValue",{type:null,required:!0}),L=x(t,"inputValue",{type:String,default:""}),b=x(t,"open",{type:Boolean,default:!1});if(typeof l.suggestions?.[0]=="object"&&!l.suggestionLabel&&!l.suggestionsFilter)throw new Error("`suggestionLabel` or `suggestionsFilter` must be passed if suggestions are objects.");const c=N(null),i=ee(ce(L,r,b,n,l));return a({suggestions:i,el:c,inputKeydownHandler:s=>{l.filterKeydown?.(s)||ue(s)||(s.key==="Enter"?(i.enterSelected(!Array.isArray(r)),s.preventDefault()):s.key==="Escape"?(i.cancel(),s.preventDefault()):!b.value&&["ArrowDown","ArrowUp","PageUp","PageDown"].includes(s.key)&&i.available?(i.open(),s.preventDefault(),s.key==="PageUp"?i.first():s.key==="PageDown"&&i.last()):s.key==="ArrowUp"?(i.prev(),s.preventDefault()):s.key==="ArrowDown"?(i.next(),s.preventDefault()):s.key==="PageUp"?(i.first(),s.preventDefault()):s.key==="PageDown"&&(i.last(),s.preventDefault()))},inputBlurHandler:s=>{l.filterBlur?.(s)||b.value&&(l.restrictToSuggestions?i.cancel():Array.isArray(r.value)||(r.value=L.value),b.value&&i.close())},inputFocusHandler:s=>{l.filterFocus?.(s)||i.open()}}),(s,u)=>b.value?(M(),D("div",T({key:0,id:`suggestions-${t.id??h(o)}`,class:h(K)(`
			suggestions
			bg-bg
			dark:bg-fg
			dark:text-bg
		`,h(g).attrs?.class),"data-open":b.value,role:"listbox",ref_key:"el",ref:c},{...h(g).attrs,class:void 0}),[(M(!0),D(te,null,se(i.filtered,(v,f)=>(M(),D("div",T({id:`suggestion-${t.id??h(o)}-${f}`,role:"option",class:h(K)(`
			suggestions--item
			user-select-none
			cursor-pointer
			px-2
		`,f===i.active&&`
				bg-accent-200
				dark:bg-accent-800/70
			`,h(g).itemAttrs?.class)},{ref_for:!0},{...h(g).itemAttrs,class:void 0},{"aria-selected":f===i.active,"aria-label":i.getLabel(v),key:v,onMouseover:w=>i.active=f,onMousedown:u[1]||(u[1]=H(()=>{},["prevent"])),onMouseup:w=>i.enterIndex(f,!Array.isArray(r.value))}),[ne(s.$slots,"item",{item:v,index:f,isSelected:Array.isArray(r.value)?r.value.includes(v):r.value===v},()=>[C("div",ye,[Array.isArray(r.value)&&t.showSelectedValues?(M(),ae(ge,{key:0,"model-value":r.value.includes(v),onMousedown:u[0]||(u[0]=H(()=>{},["prevent"]))},null,8,["model-value"])):E("",!0),C("div",null,ie(v),1)])])],16,de))),128))],16,ve)):E("",!0)}}),Me=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"}));export{Me as L,pe as _,Le as u};
