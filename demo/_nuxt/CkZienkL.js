import{j as p,r as _,Y as k,aH as j,aI as $,b1 as R,ai as ee,aJ as te,H as E,J as x,W as se,v as D,O as T,x as M,ah as ne,ag as ae,P as H,N as h,Q as C,aj as U,R as ie,y as K,L as le,z as oe}from"./Cql2C_go.js";import{u as re}from"./Cv7Eaxfl.js";import{h as ue}from"./CQ5ND8ze.js";import ge from"./CsOM0Gk0.js";import{g as fe}from"./DMGTKRWK.js";function ce(s,a,S,g,n,r=!1){if(typeof n.suggestions?.[0]=="object"&&!n.suggestionLabel&&!n.suggestionsFilter)throw new Error("`suggestionLabel` or `suggestionsFilter` must be passed if suggestions are objects.");const l=_(-1);if(k(l,e=>{g("update:activeSuggestion",e)}),n.suggestions)for(const e of n.suggestions)N(e,n.suggestionLabel);const o=e=>(N(e,n.suggestionLabel),R(e)?n.suggestionLabel(e):e),F=(e,d)=>e===""?[...d]:d.filter(y=>Array.isArray(a.value)&&a.value.includes(o(y))?!0:o(y).toLowerCase().includes(e.toLowerCase())),b=p(()=>n.suggestionsFilter??F),c=p(()=>{if(n.suggestions){const e=[...n.suggestions];return Array.isArray(a.value)&&!n.showSelectedValues&&j(e,a.value),b.value(s.value,e)}}),i=p(()=>(c.value?.length??0)>0),I=p(()=>(c.value?.length??0)>1),A=p(()=>n.suggestions?.find(e=>s.value===o(e))),q=p(()=>!n.restrictToSuggestions&&n.isValid||i.value),t=p(()=>n.canOpen&&($(s.value)&&n.allowOpenEmpty||i.value)),u=p(()=>{if(n.suggestions){const e=i.value?c.value:n.suggestions;return n.restrictToSuggestions&&!q.value,e}});function v(e){if(Array.isArray(a.value)){if(a.value.includes(e))return te(a.value,e),!0;j(a.value,[e])}else a.value=e;return!1}function f(){n.canClose&&(r&&console.log("closeSuggestions"),S.value=!1,l.value=-1)}function w(){r&&console.log("openSuggestions",{openable:t.value}),t.value&&(l.value===-1&&(A.value?l.value=c.value?.indexOf(A.value)??-1:l.value=0),S.value=!0)}function P(e,d=!0){if(e<-1||e>(u.value?.length??0)||(r&&console.log("enterSuggestion",e),u.value===void 0))return;const y=u.value[e],L=o(y),m=v(L);s.value=Array.isArray(a.value)?"":o(y),d&&f(),g("submit",L,ee(y),m)}function z(e=!0){if(l.value===-1){n.restrictToSuggestions?r&&console.log("enterSelected, no active suggestion, ignoring"):(r&&console.log("enterSelected, unrestricted, emitting submit"),g("submit",s.value));return}r&&console.log("enterSelected"),P(l.value,e)}function B(e){r&&console.log("selectSuggestion",e),e>=-1&&(l.value=e),e===1/0&&(u.value?.length??0)>0&&(l.value=u.value.length-1)}function J(){S.value?f():w()}function W(){u.value&&(l.value>0?l.value--:u.value&&(l.value=u.value.length-1))}function G(){u.value&&(l.value>=u.value.length-1?l.value=0:l.value++)}function Q(){B(0)}function Y(){B(1/0)}function X(){if(Array.isArray(a.value)){s.value="";return}r&&console.log("cancel"),s.value=o(a.value),f()}k(()=>n.canOpen,e=>{e||(r&&console.log("canOpen changed to false, closing suggestions"),f())}),k(t,e=>{e||(r&&console.log("openable changed to false, closing suggestions"),f())}),k(q,()=>{q.value||(r&&console.log("isValidSuggestion changed to false, opening suggestions"),w())}),k(a,()=>{Array.isArray(a.value)?s.value="":s.value=o(a.value),r&&console.log("modelValue changed")});function Z(e,d){if(d.length===0)return 0;let y,L=-1;for(let m=0;m<e.length;m++){const V=e[m],O=o(V);O.slice(0,d.length)===d&&O.length>(y?.[0]?.length??0)&&(y=O,L=m)}return L}return k(s,()=>{if(r&&console.log("input changed:",s.value,"modelValue:",a.value),!(!Array.isArray(a.value)&&o(a.value)===s.value))if(i.value&&(r&&console.log("input changed, suggestion available, opening suggestions"),w()),!n.restrictToSuggestions&&!Array.isArray(a.value)&&(r&&console.log("input changed, unrestricted, setting modelValue"),v(s.value)),A.value&&c.value)r&&console.log("input changed, exactly matching, setting activeSuggestion"),B(c.value.indexOf(A.value));else{r&&console.log("input changed, not exactly matching, finding longest match");const e=n.suggestionSelector?.(u.value??[],s.value)??Z(u.value??[],s.value);B(e)}}),{list:c,filtered:u,active:l,available:i,moreThanOneAvailable:I,hasExactlyMatching:A,hasValidSuggestion:q,openable:t,getLabel:o,$open:S,open:w,close:f,enterSelected:z,enterIndex:P,toggle:J,cancel:X,select:B,prev:W,next:G,first:Q,last:Y}}function ke(s,a,S,g){return p(()=>({"aria-autocomplete":g!==void 0?"both":void 0,"aria-controls":g!==void 0?`suggestions-${s.value}`:void 0,role:g?"combobox":void 0,"aria-expanded":g!==void 0?a.value:void 0,"aria-activedescendant":a.value?`suggestion-${s.value}-${S.value}`:void 0}))}function N(s,a){if(R(s)&&!a)throw new Error("`suggestionLabel` must be passed if suggestions are objects.")}const ve=["id","data-open"],de=["id","aria-selected","aria-label","onMouseover","onMouseup"],ye={class:"flex gap-2 nowrap"},pe=Object.assign({name:"LibSuggestions",inheritAttrs:!1},{__name:"WSuggestions",props:E({id:{type:String,required:!1},label:{type:String,required:!1},disabled:{type:Boolean,required:!1,default:!1},readonly:{type:Boolean,required:!1,default:!1},border:{type:Boolean,required:!1,default:!0},unstyle:{type:Boolean,required:!1,default:!1},filterKeydown:{type:Function,required:!1,default:void 0},filterBlur:{type:Function,required:!1},filterFocus:{type:Function,required:!1},suggestions:{type:Array,required:!1},suggestionLabel:{type:Function,required:!1},restrictToSuggestions:{type:Boolean,required:!1},updateOnlyOnSubmit:{type:Boolean,required:!1},suggestionsFilter:{type:Function,required:!1},allowOpenEmpty:{type:Boolean,required:!1},canOpen:{type:Boolean,required:!1,default:!0},canClose:{type:Boolean,required:!1,default:!0},isValid:{type:Boolean,required:!1,default:!0},suggestionSelector:{type:Function,required:!1},showSelectedValues:{type:Boolean,required:!1}},{modelValue:{type:null,required:!0},modelModifiers:{},inputValue:{type:String,default:""},inputValueModifiers:{},open:{type:Boolean,default:!1},openModifiers:{}}),emits:E(["submit","update:isOpen","update:activeSuggestion"],["update:modelValue","update:inputValue","update:open"]),setup(s,{expose:a,emit:S}){const g=re(["item"]),n=S,r=fe(),l=s,o=x(s,"modelValue",{type:null,required:!0}),F=x(s,"inputValue",{type:String,default:""}),b=x(s,"open",{type:Boolean,default:!1});if(typeof l.suggestions?.[0]=="object"&&!l.suggestionLabel&&!l.suggestionsFilter)throw new Error("`suggestionLabel` or `suggestionsFilter` must be passed if suggestions are objects.");const c=_(null),i=se(ce(F,o,b,n,l));return a({suggestions:i,el:c,inputKeydownHandler:t=>{l.filterKeydown?.(t)||ue(t)||(t.key==="Enter"?(i.enterSelected(!Array.isArray(o)),t.preventDefault()):t.key==="Escape"?(i.cancel(),t.preventDefault()):!b.value&&["ArrowDown","ArrowUp","PageUp","PageDown"].includes(t.key)&&i.available?(i.open(),t.preventDefault(),t.key==="PageUp"?i.first():t.key==="PageDown"&&i.last()):t.key==="ArrowUp"?(i.prev(),t.preventDefault()):t.key==="ArrowDown"?(i.next(),t.preventDefault()):t.key==="PageUp"?(i.first(),t.preventDefault()):t.key==="PageDown"&&(i.last(),t.preventDefault()))},inputBlurHandler:t=>{l.filterBlur?.(t)||b.value&&(l.restrictToSuggestions?i.cancel():Array.isArray(o.value)||(o.value=F.value),b.value&&i.close())},inputFocusHandler:t=>{l.filterFocus?.(t)||i.open()}}),(t,u)=>b.value?(M(),D("div",H({key:0,id:`suggestions-${s.id??h(r)}`,class:h(C)(`
			suggestions
			bg-bg
			dark:bg-fg
			dark:text-bg
		`,h(g).attrs?.class),"data-open":b.value,role:"listbox",ref_key:"el",ref:c},{...h(g).attrs,class:void 0}),[(M(!0),D(ne,null,ae(i.filtered,(v,f)=>(M(),D("div",H({id:`suggestion-${s.id??h(r)}-${f}`,role:"option",class:h(C)(`
			suggestions--item
			user-select-none
			cursor-pointer
			px-2
		`,f===i.active&&`
				bg-accent-200
				dark:bg-accent-800/70
			`,h(g).itemAttrs?.class)},{ref_for:!0},{...h(g).itemAttrs,class:void 0},{"aria-selected":f===i.active,"aria-label":i.getLabel(v),key:v,onMouseover:w=>i.active=f,onMousedown:u[1]||(u[1]=U(()=>{},["prevent"])),onMouseup:w=>i.enterIndex(f,!Array.isArray(o.value))}),[ie(t.$slots,"item",{item:v,index:f,isSelected:Array.isArray(o.value)?o.value.includes(v):o.value===v},()=>[K("div",ye,[Array.isArray(o.value)&&s.showSelectedValues?(M(),le(ge,{key:0,"model-value":o.value.includes(v),onMousedown:u[0]||(u[0]=U(()=>{},["prevent"]))},null,8,["model-value"])):T("",!0),K("div",null,oe(v),1)])])],16,de))),128))],16,ve)):T("",!0)}}),qe=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"}));export{qe as L,pe as _,ke as u};
